# enable kernel packet forwarding
- name: enable ipv4 forwarding
  ansible.posix.sysctl:
    name: net.ipv4.ip_forward
    value: '1'
    reload: no
    
- name: enable ipv6 forwarding
  ansible.posix.sysctl:
    name: net.ipv6.conf.all.forwarding
    value: '1'
    reload: no
    
- name: disable ipv4 redirects
  ansible.posix.sysctl:
    name: net.ipv4.conf.all.accept_redirects
    value: '0'
    reload: no
    
- name: disable ipv4 send redirects
  ansible.posix.sysctl:
    name: net.ipv4.conf.all.send_redirects
    value: '0'
    reload: yes

- name: install LibreSWAN
  apt:
    name:
      - libreswan
    state: present
    update_cache: yes

- name: configure LibreSWAN
  template:
    src: main.conf.j2
    dest: /etc/ipsec.d/main.conf
    mode: 0400

- name: add PSK
  template:
    src: ipsec.secrets.j2
    dest: /etc/ipsec.secrets
    mode: 0400

- name: apply IPSec changes
  shell: ipsec restart
